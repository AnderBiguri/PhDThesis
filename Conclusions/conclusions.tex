\chapter{Conclusions and future work}

The work presented in this thesis can be broken down into two main parts, the TIGRE Toolbox, and the motion compensation modelling technique. Extensive discussion of both has been presented in each chapter of this document, and a more general approach is taken here. 

The TIGRE Toolbox is an easy to use and fast toolbox that provides a wide variety of iterative algorithms to anyone to test. The toolbox is easy to use for both general tomography users or researchers in algorithms, as it has a highly modular design, allowing every algorithm to be used with nothing more than a simple geometry description of the machine and the data. But it also has modular blocks for the projection and backprojection operators (with different modes in each) for algorithm researchers to both explore the current algorithms in TIGRE and to implement new ones without worrying about the computationally expensive parts. 

The algorithms implemented in TIGRE are not necessarily the best algorithms nor necessarily representative of all algorithms in CT, however they are a subset of commonly known algorithms, from SART types that have been in CT since the first scans, to later additions to the field such as CGLS or ASD-POCS, they are algorithms commonly seen in the literature. However, the author highly encourages any reader to submit their implementation of new or existing algorithms to TIGRE. The more algorithms that TIGRE has implemented, the better for researchers to explore.

Computationally speaking, the linearised fast projection and backprojection methods implemented are within the fastest published methods for GPU X-ray tomography and experimentally reach very high speeds. The fact that the toolbox is an interface between the a high-level programming language and a low-level one, however, reduces the overall computational speeds of algorithms, specially with single projection update algorithms, such as SART or ASD-POCS. Most of TIGRE could be speeded up by implementing the entire algorithms directly in C++/CUDA and never using a high-level language such as MATLAB or Python, however the innovation process of writing new algorithms would be significantly crippled, as one can expect an order of magnitude more lines of code when writing the same code in C++ instead of MATLAB. The take-home message is that TIGRE is not the fastest possible iterative reconstruction toolbox as it is focused for applied research use, not designed as a final product. However, most of the algorithms can be re-coded into reconstructions within minutes using the correct approaches and hardware. The GPU kernels, however, are already highly optimized, so less work would be needed in this part.

Possibly one of the most important results of TIGRE and its iterative algorithms is the possibility of the wider applications outside lung IGRT. The variety of iterative algorithms allow users to tailor reconstruction for specific applications, as metrology, medical imaging, scientific imaging and industrial quality control (among other applications) all have very different requirements for what is ``good quality''. For example in lung IGRT and in metrology, boundaries between objects are the most important features, while in quality control or in some scientific applications (such as material sciences) small details may be what the user is looking for. Analytic algorithms such as FDK are generic, but can not be tailored to specific requirements. Due to the modular design and flexibility of TIGRE, it can be used in any application directly.


The GPU accelerated motion compensation method presented can, without any data binning, reconstruct a static image in any breathing phase using prior approximated information from the expected motion. The work here shows that if the motion is perfectly known, the reconstruction is nearly equal to a 3D static reconstruction, with minimal interpolation-caused error. The work presented in this thesis also numerically studies the effect of the most common errors in DVFs in the algorithm, showing that it has minimal impact on the reconstructed images. Also it is important to note that as the proposed CPU-based motion compensation is applied to the basic building blocks of the iterative reconstruction, any existing (and possibly, future) iterative algorithm can be used together with the motion modelling method to reconstruct static images, as it is shown with SART and ASD-POCS. 

This thesis shows the potential that motion compensation and iterative algorithms can have in IGRT and particularly in hadron therapy. And making all available code and algorithms public paves the way for further test with clinical data, hopefully bringing adaptive RT therapy closer to an every day treatment for lung cancer patients.


\section{Future work}

As is common with research, the future work possibilities span a wider and longer research focus than the work itself. From the two main research items presented  in this thesis (TIGRE and motion compensation), the future work diverges.

The TIGRE toolbox can be enhanced in multiple ways. The toolbox itself lacks X-ray based Input/Output functions (e.g. reading Nikkon, or DIDCOM data and writing in ``vol'' or other formats) that would make the software considerably more approachable for users who only want to experiment with the code. The range of iterative algorithms is a clear place to enhance the toolbox, specially in Krylov subspace methods and statistical methods. The former because the algorithms converge very fast compared with classic methods, the latter because there are no algorithms of that type in TIGRE and it would benefit from a new iterative approach than currently present. Certainly any addition to pre-or post-processing techniques can be part of future work.

On the more computational side, implementing a matched backprojection would be the next step. Algorithms like CGLS (Krylov subspace algorithms) are greatly affected by having only a partially matched backprojection, and while each iteration would be slower with it, a more robust usage of these algorithms would be possible, thus making the global reconstruction times faster. On the GPU methods side, there are few possibilities that are mentioned in Chapter 4 for exploring acceleration of the projection operator, but results may not be as good as presented in the literature. Finally, the computational side would benefit greatly from multi-GPU support of TIGRE. At the time of writing, a multi-GPU branch is available in GitHub (thanks to R.B.), but it is still not fully integrated in TIGRE.

On the software engineering side, TIGRE would clearly benefit from: being totally free. At this time, TIGRE's full potential can only be exploited with the MATLAB software, and a less complete Python version is available. Making TIGRE fully available for in Python would make the toolbox available for an even wider audience. We encourage users to contribute to the Python version.

The GPU-based motion compensation method has a different, yet clear future work. The method has been shown working to high robustness and image reconstruction quality using synthetic data, the next step would be to introduce it to real CBCT projections and to have a wider test with multiple CBCT datasets. Additionally, exploring which DVF computation method is a must, which would possible lead to a change in the way DVFs are handled. For example, some deformation computation methods output a function representation, as opposed to vector representation, of the deformation in the image. Including direct sampling from the function, instead of from a DVF, in the kernels has the potential of accelerating the reconstruction even more, as DVFs are memory expensive and take time to transfer, and kernels would not need to do memory reads as instead just arithmetic operations would suffice, which is faster.

Additionally, the motion compensation method would need to be tested against the most promising  4D-CBCT methods presented in the literature, to ensure that both the radiation is reduced in comparison, but also to check the quality of the reconstruction. If other 4D-CBCT methods are considerably better, then even with the reduced X-ray dose it is likely that the motion compensation would not reach clinical trials.

Hopefully the high flexibility of scientific applications of the iterative algorithms in TIGRE will start a discussion on having application tailored reconstruction and will start research across the field. Some of the future work is already starting to get explored now, but I highly encourage the fellow reader to get excited and look into contributing to these fantastic research topics that are image reconstruction and medical imaging!

