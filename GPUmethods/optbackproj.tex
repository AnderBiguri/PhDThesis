\documentclass{article}

\usepackage{tikz}
\usetikzlibrary{calc,3d,arrows,shapes}
\usepackage{tikz-3dplot}
\usepackage{amsmath}
\usepackage{amsfonts}
\usetikzlibrary{external}
\tikzexternalize % activate!
\begin{document}

\begin{figure}[H]

\tdplotsetmaincoords{70}{125} % rotate 60 degrees around x axis, then 105 degrees about z
\begin{tikzpicture}[>=stealth',           % arrow tip
                    tdplot_main_coords,   % Set view as defined by \tdplotsetmaincoords
                    scale=0.4               % scale
                    ]  
    
    
    
    
    
% kernel block
   \newcommand{\kernelS}{1}

   \coordinate (D1) at (-\kernelS,-\kernelS*2,-\kernelS);
   \coordinate (D2) at (-\kernelS,-\kernelS*2,\kernelS);
   \coordinate (D3) at (-\kernelS,\kernelS,\kernelS);
   \coordinate (D4) at (-\kernelS,\kernelS,-\kernelS);
   \coordinate (D5) at (\kernelS,-\kernelS*2,-\kernelS);
   \coordinate (D6) at (\kernelS,-\kernelS*2,\kernelS);
   \coordinate (D7) at (\kernelS,\kernelS,\kernelS);
   \coordinate (D8) at (\kernelS,\kernelS,-\kernelS);
       \coordinate (T2) at (-2,-0.,-0.);

  \draw[black,fill=red!50,opacity=0.3,draw=gray] ($(D1)+(T2)$) -- ($(D2)+(T2)$) -- ($(D3)+(T2)$) -- ($(D4)+(T2)$) -- cycle;% -X face
	\draw[black,fill=red!50,opacity=0.3,draw=gray] ($(D2)+(T2)$) -- ($(D3)+(T2)$) -- ($(D7)+(T2)$) -- ($(D6)+(T2)$) -- cycle;% +Z face
	\draw[black,fill=red!50,opacity=0.3,draw=gray] ($(D1)+(T2)$) -- ($(D2)+(T2)$) -- ($(D6)+(T2)$) -- ($(D5)+(T2)$) -- cycle;% -Y face
	\draw[black,fill=red!50,opacity=0.3,draw=gray] ($(D3)+(T2)$) -- ($(D4)+(T2)$) -- ($(D8)+(T2)$) -- ($(D7)+(T2)$) -- cycle;% Right Face
	\draw[black,fill=red!50,opacity=0.5,draw=gray] ($(D1)+(T2)$) -- ($(D4)+(T2)$) -- ($(D8)+(T2)$) -- ($(D5)+(T2)$) -- cycle;% Front Face
	\draw[black,fill=red!50,opacity=0.3,draw=gray] ($(D5)+(T2)$) -- ($(D6)+(T2)$) -- ($(D7)+(T2)$) -- ($(D8)+(T2)$) -- cycle;% Top Face
	
	
	%% tread

\foreach \x in {-1,-0.5,...,2}
	\draw[gray,thin] ($(D5)+(T2)+(0,\x+1,0)$)--($(D6)+(T2)+(0,\x+1,0)$);
%\foreach \x in   {-1,-0.5,0,0.5,1}
%	\draw[gray,thin] ($(D6)+(T2)+(0,0,\x-1)$)--($(D7)+(T2)+(0,0,\x-1)$);
	
\foreach \x in {-1,-0.5,0,0.5,1}
	\draw[gray,thin] ($(D6)+(T2)+(\x-1,0,0)$)--($(D7)+(T2)+(\x-1,0,0)$);
\foreach \x in   {-1,-0.5,0,0.5,1,1.5,2}
	\draw[gray,thin] ($(D2)+(T2)+(0,\x+1,0)$)--($(D6)+(T2)+(0,\x+1,0)$);
%	
\foreach \x in {-1,-0.5,0,0.5,1}
	\draw[gray,thin] ($(D7)+(T2)+(\x-1,0,0)$)--($(D8)+(T2)+(\x-1,0,0)$);
%\foreach \x in   {-1,-0.5,0,0.5,1}
%	\draw[gray,thin] ($(D8)+(T2)+(0,0,\x+1)$)--($(D4)+(T2)+(0,0,\x+1)$);
%	
%	
%	
		   \newcommand{\threadS}{0.25}
		   \newcommand{\threadSZ}{1}
     \coordinate (D1) at (-\threadS,-\threadS,-\threadS);
   \coordinate (D2) at (-\threadS,-\threadS,\threadS);
   \coordinate (D3) at (-\threadS,\threadS,\threadS);
   \coordinate (D4) at (-\threadS,\threadS,-\threadS);
   \coordinate (D5) at (\threadS,-\threadS,-\threadS);
   \coordinate (D6) at (\threadS,-\threadS,\threadS);
   \coordinate (D7) at (\threadS,\threadS,\threadS);
   \coordinate (D8) at (\threadS,\threadS,-\threadS);
   
\foreach \x in {0,0.5,...,1.5}{
      \coordinate (T2) at (-1-\threadS,1-\threadS,1-\threadS-\threadS*4*\x); 

   \draw[fill=red,opacity=0.3] ($(D1)+(T2)$) -- ($(D2)+(T2)$) -- ($(D3)+(T2)$) -- ($(D4)+(T2)$) -- cycle;% -X face
	\draw[fill=red,opacity=0.3] ($(D2)+(T2)$) -- ($(D3)+(T2)$) -- ($(D7)+(T2)$) -- ($(D6)+(T2)$) -- cycle;% +Z face
	\draw[fill=red,opacity=0.3] ($(D1)+(T2)$) -- ($(D2)+(T2)$) -- ($(D6)+(T2)$) -- ($(D5)+(T2)$) -- cycle;% -Y face
	\draw[fill=red,opacity=0.3] ($(D3)+(T2)$) -- ($(D4)+(T2)$) -- ($(D8)+(T2)$) -- ($(D7)+(T2)$) -- cycle;% Right Face
	\draw[fill=red,opacity=0.5] ($(D1)+(T2)$) -- ($(D4)+(T2)$) -- ($(D8)+(T2)$) -- ($(D5)+(T2)$) -- cycle;% Front Face
	\draw[fill=red,opacity=0.3] ($(D5)+(T2)$) -- ($(D6)+(T2)$) -- ($(D7)+(T2)$) -- ($(D8)+(T2)$) -- cycle;% Top Face
      
    }
    
    
%                    
%   %%%%%%%Some inside figure preable, for variables that are going to be repated
   %Trasnlation of CUBE
   \newcommand{\Tx}{0} 
   \newcommand{\Ty}{0} 
   \newcommand{\Tz}{0}
   \coordinate (T) at (\Tx,\Ty,\Tz);
   % Cube coords
   \newcommand{\CubeSz}{3}
   \coordinate (P1) at (-\CubeSz,-\CubeSz,-\CubeSz);
   \coordinate (P2) at (-\CubeSz,-\CubeSz,\CubeSz);
   \coordinate (P3) at (-\CubeSz,\CubeSz,\CubeSz);
   \coordinate (P4) at (-\CubeSz,\CubeSz,-\CubeSz);
   \coordinate (P5) at (\CubeSz,-\CubeSz,-\CubeSz);
   \coordinate (P6) at (\CubeSz,-\CubeSz,\CubeSz);
   \coordinate (P7) at (\CubeSz,\CubeSz,\CubeSz);
   \coordinate (P8) at (\CubeSz,\CubeSz,-\CubeSz);
   
  
   
   
   
   \newcommand{\DetSzOne}{5}
   \newcommand{\DetSzTwo}{0.2}

   \coordinate (D1) at (-\DetSzTwo,-\DetSzOne,-\DetSzOne);
   \coordinate (D2) at (-\DetSzTwo,-\DetSzOne,\DetSzOne);
   \coordinate (D3) at (-\DetSzTwo,\DetSzOne,\DetSzOne);
   \coordinate (D4) at (-\DetSzTwo,\DetSzOne,-\DetSzOne);
   \coordinate (D5) at (\DetSzTwo,-\DetSzOne,-\DetSzOne);
   \coordinate (D6) at (\DetSzTwo,-\DetSzOne,\DetSzOne);
   \coordinate (D7) at (\DetSzTwo,\DetSzOne,\DetSzOne);
   \coordinate (D8) at (\DetSzTwo,\DetSzOne,-\DetSzOne);
    \coordinate (T2) at (-15,-0.,-0.);
   % offset vector

   %Draw CUBE
    \draw[black,fill=blue,opacity=0.05] ($(P1)+(T)$) -- ($(P2)+(T)$) -- ($(P3)+(T)$) -- ($(P4)+(T)$) -- cycle;% -X face
	\draw[black,fill=blue!20,opacity=0.05] ($(P2)+(T)$) -- ($(P3)+(T)$) -- ($(P7)+(T)$) -- ($(P6)+(T)$) -- cycle;% +Z face
	\draw[black,fill=blue,opacity=0.05] ($(P1)+(T)$) -- ($(P2)+(T)$) -- ($(P6)+(T)$) -- ($(P5)+(T)$) -- cycle;% -Y face
	\draw[black,fill=blue,opacity=0.05] ($(P3)+(T)$) -- ($(P4)+(T)$) -- ($(P8)+(T)$) -- ($(P7)+(T)$) -- cycle;% Right Face
	\draw[black,fill=blue,opacity=0.1] ($(P1)+(T)$) -- ($(P4)+(T)$) -- ($(P8)+(T)$) -- ($(P5)+(T)$) -- cycle;% Front Face
	\draw[black,fill=blue,opacity=0.05] ($(P5)+(T)$) -- ($(P6)+(T)$) -- ($(P7)+(T)$) -- ($(P8)+(T)$) -- cycle;% Top Face
	
	%image
	\node at ($(P2)+(T)+(0,0,0.5)$){\Large $\mathbb{I}$};
	\node at ($(D2)+(T2)+(0,0,0.5)$){\Large $\mathbb{D}$};
	

	
	
	

  

    \draw[black,fill=black,opacity=0.05] ($(D1)+(T2)$) -- ($(D2)+(T2)$) -- ($(D3)+(T2)$) -- ($(D4)+(T2)$) -- cycle;% -X face
	\draw[black,fill=black!20,opacity=0.05] ($(D2)+(T2)$) -- ($(D3)+(T2)$) -- ($(D7)+(T2)$) -- ($(D6)+(T2)$) -- cycle;% +Z face
	\draw[black,fill=black,opacity=0.1] ($(D1)+(T2)$) -- ($(D2)+(T2)$) -- ($(D6)+(T2)$) -- ($(D5)+(T2)$) -- cycle;% -Y face
	\draw[black,fill=black!20,opacity=0.05] ($(D3)+(T2)$) -- ($(D4)+(T2)$) -- ($(D8)+(T2)$) -- ($(D7)+(T2)$) -- cycle;% Right Face
	\draw[black,fill=black,opacity=0.1] ($(D1)+(T2)$) -- ($(D4)+(T2)$) -- ($(D8)+(T2)$) -- ($(D5)+(T2)$) -- cycle;% Front Face
	\draw[black,fill=black,opacity=0.05] ($(D5)+(T2)$) -- ($(D6)+(T2)$) -- ($(D7)+(T2)$) -- ($(D8)+(T2)$) -- cycle;% Top Face


%\draw[black,fill=red,opacity=0.5] ($(0,1,3)+(T2)$) -- ($(0,1,1)+(T2)$) -- ($(0,3,1)+(T2)$) -- ($(0,3,3)+(T2)$) -- cycle;% Top Face




\draw[black](10,0,0)--(-1.25,0.75,0.25); \fill (-1.25,0.75,0.75) circle [radius=3pt];
\draw[black, dashed](-1.25,0.75,0.25)--(-15,1.666,0.55);
 \fill (-15,1.666,0.55) circle [radius=3pt];

\draw[black](10,0,0)--(-1.25,0.75,0.75); \fill (-1.25,0.75,0.25) circle [radius=3pt];
\draw[black, dashed](-1.25,0.75,0.75)--(-15,1.666,1.665);
 \fill (-15,1.666,1.666) circle [radius=3pt];

\draw[black](10,0,0)--(-1.25,0.75,-0.25); \fill (-1.25,0.75,-0.25) circle [radius=3pt];
\draw[black, dashed](-1.25,0.75,-0.25)--(-15,1.666,-0.55);
 \fill (-15,1.666,-0.55) circle [radius=3pt];

\draw[black](10,0,0)--(-1.25,0.75,-0.25); \fill (-1.25,0.75,-0.75) circle [radius=3pt];
\draw[black, dashed](-1.25,0.75,-0.75)--(-15,1.666,-1.665);
 \fill (-15,1.666,-1.666) circle [radius=3pt];


 
 
 
 
 \coordinate (T3) at (-15,1.4,0.4);
\foreach \x in {-4,-3,...,3}
	\draw[gray!50,thin, dashed] ($(T3)+(0,\x,-4+rand)$)--($(T3)+(0,\x,4+rand)$);
\foreach \x in   {-4,-3,...,4}
	\draw[gray!50,thin, dashed] ($(T3)+(0,-4+rand,\x)$)--($(T3)+(0,3+rand*0.5,\x)$);
	

\coordinate (T3) at (-15,1.4,0.4);
\foreach \x in {-2,-1,...,2}
	\draw[gray,thin] ($(T3)+(0,\x,-3+rand*0.5)$)--($(T3)+(0,\x,2+rand*0.5)$);
\foreach \x in   {-3,-2,...,2}
	\draw[gray,thin] ($(T3)+(0,-2+rand*0.5,\x)$)--($(T3)+(0,2+rand*0.5,\x)$);
	


 
 
% 
   \draw[thick,->] (0,4,-4)node[anchor=north west, align=left]{Single thread} -- (-1.25,1,-0.75) ;
%%   
 \draw[thick,->] (0,-4,4)node[anchor=south east, align=left]{Thread block} -- (-1.5,-1,1) ;
% 
  \draw[thick,->] (0,15,0)node[anchor=north west, align=left]{Interpolated read} -- (-15,1.666,0.55) ;

     \draw[->] (0,0,8) ++ (20+40:1.5) arc (20+40:340+40:1.5);
      \node at (0,0,9){$\theta$};
      \node at (0,-1,10){For several projections};

% \draw[<->](-12,3.2,1)--(-12,3.2,3);
% \node at (-12,4.5,2.2){${\scriptsize divV}$};
% 
%  \draw[<->](-12,1,3.2)--(-12,3,3.2);
% \node at (-12,2.2,3.9){${\scriptsize divU}$};
	 %% Source
    \newcommand{\rotatedtangentangle}[1]{%
    % find directions of projection
    \path[tdplot_rotated_coords] (1,0,0);
    \pgfgetlastxy{\axisxx}{\axisxy}
    \path[tdplot_rotated_coords] (0,1,0);
    \pgfgetlastxy{\axisyx}{\axisyy}
    \path[tdplot_rotated_coords] (0,0,1);
    \pgfgetlastxy{\axiszx}{\axiszy}
    % angle of tangent
    \pgfmathsetmacro{\rtang}{atan(-\axiszy/\axiszx)+180}
    \pgfmathsetmacro{\angkorr}{atan(\axisyy/\axisyx)/2}

    \pgfmathsetmacro{#1}{\rtang+\angkorr}
}%      
    \tdplotsetthetaplanecoords{90} % create rotated frame
    \rotatedtangentangle{\tangent} % compute tanget angle
    % shift rotated frame to center of cylinder
    \coordinate (shift) at (10,0,0);
    \tdplotsetrotatedcoordsorigin{(shift)}
    % draw cylinder
    \begin{scope}[tdplot_rotated_coords]
        \draw[fill=red!30]
            (0,0,-1.5) ++(\tangent:0.5) -- ++(0,0,1.5) arc (\tangent:\tangent-180:0.5) -- ++(0,0,-1.5);
        \draw[fill=red!30] (0,0,-1.5) circle [radius=0.5];
        
    \end{scope}
    \node at (10.4,0,0) {S};
	
    
\end{tikzpicture}
\centering

\end{figure}

\end{document}
